(this.webpackJsonptellulf=this.webpackJsonptellulf||[]).push([[0],{104:function(t,e,a){},205:function(t,e,a){t.exports=a(437)},210:function(t,e,a){},408:function(t,e,a){},435:function(t,e,a){},437:function(t,e,a){"use strict";a.r(e);var n=a(1),o=a.n(n),r=a(36),s=a.n(r),i=(a(210),a(2)),c=a.n(i),l=a(18),u=(a(215),a(11)),d=a.n(u);function m(t,e){const a=10**e;return Math.round(a*t)/a}class p extends o.a.PureComponent{smartRoundWatt(t){const e=Math.round(t),a=this.props.unitSpace?" ":"";return 0===e?"-":e<100?"".concat(e.toLocaleString()):"".concat((Math.round(e/100)/10).toLocaleString()).concat(a,"k")}render(){let t="-";if("number"===typeof this.props.info){if(Number.isNaN(this.props.info))return null;let e=this.props.invertValue?-1*this.props.info:this.props.info;this.props.absoluteValue&&(e=Math.abs(e)),t=this.props.smartRoundKw?this.smartRoundWatt(e):m(e,this.props.decimals).toLocaleString()}else"string"===typeof this.props.info&&(t=this.props.info);let{fontSize:e}=this.props;16===this.props.fontSize&&this.props.large&&(e=24);const a=this.props.unitSpace?" ":null,n=this.props.info>=0?this.props.color:this.props.colorIfNegative;let r=this.props.header;return this.props.info<0&&void 0!==this.props.headerIfNegative&&(r=this.props.headerIfNegative),o.a.createElement("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"spaceAround",alignItems:"center",fontSize:e}},this.props.header&&o.a.createElement("span",{style:{fontSize:10,color:this.props.labelColor}},r),o.a.createElement("span",{style:{color:n}},t,a,this.props.unit))}}p.defaultProps={header:void 0,headerIfNegative:void 0,info:"-",large:!1,fontSize:16,decimals:0,unit:"",unitSpace:!1,color:"#FFFFFF",labelColor:"#777777",colorIfNegative:"#FFFFFF",invertValue:!1,absoluteValue:!1,smartRoundKw:!1};var h=p;a(104);class f extends o.a.PureComponent{getMinUsage(t){const e=t?this.props.maxPowerProductionHytta:this.props.maxPowerProduction,a=t?this.props.consumptionMinimumHytta:this.props.consumptionMinimum;return e>0?o.a.createElement(h,{key:"maxProd",info:e,header:"max prod",smartRoundKw:!0,unit:"W"}):o.a.createElement(h,{key:"maxProd",info:a,header:"min bruk",smartRoundKw:!0,unit:"W"})}render(){return o.a.createElement("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"space-evenly"}},o.a.createElement("div",{className:"energyTableRow"},"Hjemme"),o.a.createElement("div",{className:"energyTableRow"},o.a.createElement(h,{info:this.props.netDay,unit:"kr",header:"netto dag",decimals:2,unitSpace:!0,key:"netDay"}),o.a.createElement(h,{info:this.props.accumulatedConsumption,unit:"kWh",header:"forbruk i dag",key:"paidDay",decimals:1}),o.a.createElement(h,{info:this.props.accumulatedProduction,unit:"kWh",header:"solgt i dag",key:"soldDay",decimals:1})),o.a.createElement("div",{className:"energyTableRow"},o.a.createElement(h,{info:this.props.producedPercent,unit:"%",header:"produsert %",decimals:1,key:"prodPercent"}),this.getMinUsage(!1),o.a.createElement(h,{info:this.props.consumptionMaximum,header:"max bruk",key:"maxBruk",smartRoundKw:!0,unit:"W"})),o.a.createElement("div",{className:"energyTableRow"},o.a.createElement(h,{info:this.props.localProductionDay,unit:"kWh",header:"prod dag",decimals:1,key:"prodDay"}),o.a.createElement(h,{info:this.props.localProductionMonth,unit:"kWh",header:"prod m\xe5ned",decimals:0,key:"prodMonth"}),o.a.createElement(h,{info:this.props.localProductionYear/1e3,unit:"MWh",header:"prod \xe5r",decimals:1,key:"prodYear"})),o.a.createElement("div",{className:"energyTableRow"},"Hytta"),o.a.createElement("div",{className:"energyTableRow"},o.a.createElement(h,{info:this.props.netDayHytta,unit:"kr",header:"netto dag",decimals:1,key:"cabinMoney"}),o.a.createElement(h,{info:this.props.accumulatedConsumptionHytta,unit:"kWh",header:"forbruk i dag",decimals:1,key:"cabinUsed"}),o.a.createElement(h,{info:this.props.accumulatedProductionHytta,unit:"kWh",header:"solgt i dag",decimals:1,key:"cabinMade"})),o.a.createElement("div",{className:"energyTableRow"},o.a.createElement(h,{info:this.props.currentConsumptionHytta,unit:"W",header:"forbruk n\xe5",decimals:0,key:"cabinCurrent"}),this.getMinUsage(!0),o.a.createElement(h,{info:this.props.consumptionMaximumHytta,unit:"W",header:"max bruk",decimals:1,smartRoundKw:!0,key:"cabinMaxUse"})))}}f.defaultProps={currentPower:0,netDay:0,currentConsumption:0,currentSolarProduction:0,producedPercent:0,accumulatedConsumption:0,consumptionMinimum:0,consumptionAverage:0,consumptionMaximum:0,accumulatedProduction:0,accumulatedCost:0,accumulatedReward:0,maxPowerProduction:0,localProductionDay:0,localProductionMonth:0,localProductionYear:0,localProductionTotal:0,localProductionMaxDay:0,localProductionMaxMonth:0,localProductionMaxYear:0,localProductionMaxTotal:0};var y=f;class g extends o.a.PureComponent{render(){let t=0;try{if(this.props.realtimePower.accumulatedConsumption){const e=this.props.currentSolarProduction.today+1e3*this.props.realtimePower.accumulatedConsumption-1e3*this.props.realtimePower.accumulatedProduction;t=this.props.currentSolarProduction.today/e*100}}catch(e){console.log(e)}return o.a.createElement(y,{currentPower:this.props.currentNetConsumption,currentConsumption:this.props.realtimePower.calculatedConsumption,currentConsumptionHytta:this.props.realtimePowerHytta.calculatedConsumption,currentSolarProduction:this.props.currentSolarProduction.now,producedPercent:t,accumulatedConsumption:this.props.realtimePower.accumulatedConsumption,accumulatedConsumptionHytta:this.props.realtimePowerHytta.accumulatedConsumption,accumulatedProduction:this.props.realtimePower.accumulatedProduction,accumulatedProductionHytta:this.props.realtimePowerHytta.accumulatedProduction,consumptionMinimum:this.props.realtimePower.minPower,consumptionMaximum:this.props.realtimePower.maxPower,consumptionAverage:this.props.realtimePower.averagePower,consumptionMinimumHytta:this.props.realtimePowerHytta.minPower,consumptionMaximumHytta:this.props.realtimePowerHytta.maxPower,consumptionAverageHytta:this.props.realtimePowerHytta.averagePower,localProductionDay:this.props.currentSolarProduction.today/1e3,localProductionMonth:this.props.currentSolarProduction.month/1e3,localProductionYear:this.props.currentSolarProduction.year/1e3,localProductionTotal:this.props.currentSolarProduction.total/1e3,localProductionMaxDay:this.props.max.maxDay,localProductionMaxMonth:this.props.max.maxMonth,localProductionMaxYear:this.props.max.maxYear,localProductionMaxTotal:this.props.max.maxEver,accumulatedReward:this.props.realtimePower.accumulatedReward,accumulatedRewardHytta:this.props.realtimePowerHytta.accumulatedReward,maxPowerProduction:this.props.realtimePower.maxPowerProduction,maxPowerProductionHytta:this.props.realtimePowerHytta.maxPowerProduction,accumulatedCost:this.props.realtimePower.accumulatedCost,accumulatedCostHytta:this.props.realtimePowerHytta.accumulatedCost,netDay:this.props.realtimePower.actualCost,netDayHytta:this.props.realtimePowerHytta.actualCost})}}var w=g,v=a(8),E=a(66),P=a.n(E);function x(t,e=59.9409,a=10.6991){const n=P.a.getPosition(c()(t).toDate(),e,a);return Math.max(0,n.altitude)}function b(t){const e=Math.ceil(t/1e3);return Math.max(5,e)}function k(t){return"".concat(m(t,1))}function D(){const{start:t,end:e}={start:c()().startOf("day"),end:c()().add(1,"day").startOf("day")},a=[];for(;t.isSameOrBefore(e);)t.hours()%2===0&&a.push(t.valueOf()),t.add(1,"hours");return a}function T(t){return c()(t).local().format("HH")}const M=function(t=59.9409,e=10.6991){try{const a=c()("2018-06-21").toDate(),n=P.a.getTimes(a,t,e);return P.a.getPosition(n.solarNoon,t,e).altitude}catch(a){return 1}}();class S extends o.a.PureComponent{constructor(t){super(t),this.state=void 0,this.interval=0,this.state={currentTime:c()().valueOf()}}componentDidMount(){this.interval=window.setInterval(()=>{this.reloadTime()},3e5)}componentWillUnmount(){window.clearInterval(this.interval)}getData(){const t=function(){const t={},e=c()().startOf("day");for(let a=0;a<144;a+=1){const a=e.valueOf();t[a]={time:a,production:null,price:null,consumption:null},e.add(10,"minutes")}return t}(),e=c()().isDST()?36e5:0,a=new Date;return this.props.currentSolarProduction.byHour.forEach(n=>{const o=n.time+36e5+e;if(o in t&&(t[o].production=n.production/1e3),n.time in t){const e=new Date(n.time),o=c()(n.time).add(1,"week").toDate(),r=c()(n.time).add(2,"week").toDate(),s=c()(n.time).add(1,"month").toDate(),i=e.getHours(),l=this.props.powerPrices[i];if(t[n.time].price=l.total,t[n.time].sun=x(e,this.props.latitude,this.props.longitude),t[n.time].sunInAWeek=x(o,this.props.latitude,this.props.longitude),t[n.time].sunInTwoWeeks=x(r,this.props.latitude,this.props.longitude),t[n.time].sunInAMonth=x(s,this.props.latitude,this.props.longitude),e<a){if(i in this.props.usedPower){const e=this.props.usedPower[i],a=Number(e.consumption);t[n.time].consumption=a}c()(e).isSame(c()(),"hour")&&(t[n.time].consumption=this.props.realtimePower.avgLastHour/1e3)}}}),Object.values(t)}reloadTime(){this.setState({currentTime:c()().valueOf()})}render(){if(!this.props.initState.powerPrices||!this.props.initState.solar)return null;const t=this.getData();return o.a.createElement("div",{style:{height:"12vh",width:"100%"}},o.a.createElement(v.i,{width:"100%",height:"100%"},o.a.createElement(v.c,{margin:{top:0,right:10,left:10,bottom:0},data:t},o.a.createElement(v.j,{dataKey:"time",type:"number",scale:"time",tickFormatter:T,allowDataOverflow:!1,ticks:D(),domain:[c()().startOf("day").valueOf(),c()().endOf("day").valueOf()]}),!1,o.a.createElement(v.k,{width:10,yAxisId:"kwh",type:"number",tickFormatter:k,domain:[0,b]},!1),o.a.createElement(v.k,{width:0,yAxisId:"sun",hide:!0,allowDataOverflow:!0,ticks:[],type:"number",orientation:"right",domain:[0,M]}),!1,o.a.createElement(v.e,{dot:!1,yAxisId:"sun",type:"basis",dataKey:"sun",stroke:"#FFFFFF88"}),o.a.createElement(v.e,{dot:!1,yAxisId:"sun",type:"basis",dataKey:"sunInAWeek",stroke:"#FFFFFF55"}),o.a.createElement(v.e,{dot:!1,yAxisId:"sun",type:"basis",dataKey:"sunInTwoWeeks",stroke:"#FFFFFF33"}),o.a.createElement(v.e,{dot:!1,yAxisId:"sun",type:"basis",dataKey:"sunInAMonth",stroke:"#FFFFFF22"}),o.a.createElement(v.a,{yAxisId:"kwh",dot:!1,type:"monotone",dataKey:"production",fill:"#00FF00",stroke:"#00FF00",fillOpacity:"0.2",strokeOpacity:"0.2",stackId:"1"}),o.a.createElement(v.a,{yAxisId:"kwh",dot:!1,type:"monotone",dataKey:"consumption",fill:"#FF0000",stroke:"#FF0000",fillOpacity:"0.15",strokeOpacity:"0.15",stackId:"1"}),!1,o.a.createElement(v.h,{yAxisId:"kwh",y:this.props.max.maxDay/1e3,stroke:"#FFFF0088",strokeDasharray:"3 3"}),o.a.createElement(v.g,{x:this.state.currentTime,y:x(this.state.currentTime,this.props.latitude,this.props.longitude),yAxisId:"sun",fill:"#FFFF00",stroke:"none",r:4,label:""}),!1,!1)))}}var C=S;const I={padding:"8px 0px 8px 0px",fontSize:"12px",alignSelf:"center"},A={width:"100%",display:"flex",flexDirection:"row"},H={alignItems:"center",flexDirection:"row",display:"flex",transition:"width 3s",justifyContent:"center"},F={alignItems:"center",display:"flex",flex:1,transition:"width 1s",justifyContent:"flex-start",backgroundColor:"#00000033"};class O extends o.a.PureComponent{render(){const t=c()(),e=t.format("dddd:"),a=t.format("MMM:"),n=t.format("YYYY:"),r=this.props.ever?this.props.ever:4254,s=this.props.currentProduction/r*100,i=this.props.day/r*100,l=this.props.month/r*100,u=this.props.year/r*100,d="".concat(s,"%"),m="".concat(i,"%"),p="".concat(l,"%"),h="".concat(u,"%"),f="".concat(100,"%"),y="n\xe5: ".concat(this.props.currentProduction," W"),g="".concat(e," ").concat(this.props.day," W"),w="".concat(a," ").concat(this.props.month," W"),v="".concat(n," ").concat(this.props.year," W"),E=s>50?y:"",P=s>50?"":y,x=i>50?g:"",b=i>50?"":g,k=l>50?w:"",D=l>50?"":w,T=u>50?v:"",M=u>50?"":v;return o.a.createElement("div",{style:{height:"12vh",width:"90%",padding:"0 5% 0 5%",display:"flex",flexDirection:"column",overflow:"hidden",alignItems:"flex-start",justifyContent:"flex-start",marginTop:"1vh"}},o.a.createElement("div",{style:{...A}},o.a.createElement("div",{style:{...H,backgroundColor:"#00FF0055",width:d}},o.a.createElement("span",{style:I},E)),o.a.createElement("div",{style:F},o.a.createElement("span",{style:I},P))),o.a.createElement("div",{style:{...A}},o.a.createElement("div",{style:{...H,backgroundColor:"#00FF0055",width:m}},o.a.createElement("span",{style:I},x)),o.a.createElement("div",{style:F},o.a.createElement("span",{style:I},b))),o.a.createElement("div",{style:{...A}},o.a.createElement("div",{style:{...H,backgroundColor:"#00FF0044",width:p}},o.a.createElement("span",{style:I},k)),o.a.createElement("div",{style:F},o.a.createElement("span",{style:I},D))),o.a.createElement("div",{style:{...A}},o.a.createElement("div",{style:{...H,backgroundColor:"#00FF0033",width:h}},o.a.createElement("span",{style:I},T)),o.a.createElement("div",{style:F},o.a.createElement("span",{style:I},M))),o.a.createElement("div",{style:{...A}},o.a.createElement("div",{style:{...H,backgroundColor:"#00FF0022",width:f}},o.a.createElement("span",{style:I},"max: ",r," W")),o.a.createElement("div",{style:F},o.a.createElement("span",{style:I},M))))}}O.defaultProps={day:0,month:0,year:0,ever:4500};var R=O;class _ extends o.a.PureComponent{constructor(...t){super(...t),this.interval=0}componentDidMount(){const{tibber:t,solar:e}=this.props.updaters;t.updatePowerPrices(),t.subscribeToRealTime("2b05f8c5-3241-465d-92b8-9e7ad567f78f","hjemme"),t.subscribeToRealTime("61f93ce4-f15c-49c2-aac1-9d9f0e1d76bb","hytta"),t.updateConsumption(),t.updateConsumptionDaily(),this.interval=window.setInterval(()=>t.updateConsumption(),6e4),e.attachListeners(),e.attachMaxListeners()}componentWillUnmount(){window.clearInterval(this.interval)}render(){if(!this.props.initState.solar)return null;const t=this.props.realtimePowerHjemme.calculatedConsumption,e=this.props.realtimePowerHytta.calculatedConsumption,a=t+e;return o.a.createElement("div",{style:{display:"flex",flex:1,flexDirection:"column",height:"100%"}},o.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginBottom:20}},o.a.createElement(h,{info:a,header:"Totalt n\xe5",large:!0,smartRoundKw:!0,key:"currentConsumption",unit:"W"}),o.a.createElement(h,{info:t,header:"Hus n\xe5",large:!0,smartRoundKw:!0,key:"currentConsumptionHome",unit:"W"}),o.a.createElement(h,{info:e,header:"Hytta n\xe5",large:!0,smartRoundKw:!0,key:"currentConsumptionHytta",unit:"W"})),o.a.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:20}},o.a.createElement(C,{latitude:this.props.latitude,longitude:this.props.longitude,usedPower:this.props.usedPower,realtimePower:this.props.realtimePowerHjemme,initState:this.props.initState,powerPrices:this.props.powerPrices,max:this.props.max,currentSolarProduction:this.props.currentSolarProduction,currentNetConsumption:t})),o.a.createElement("div",{style:{display:"flex",alignItems:"center"}},o.a.createElement(w,{currentSolarProduction:this.props.currentSolarProduction,max:this.props.max,realtimePower:this.props.realtimePowerHjemme,realtimePowerHytta:this.props.realtimePowerHytta,currentNetConsumption:t})),o.a.createElement("div",{style:{display:"flex",alignItems:"center"}},o.a.createElement(R,{day:this.props.max.maxDay,year:this.props.max.maxYear,month:this.props.max.maxMonth,ever:this.props.max.maxEver,currentProduction:this.props.currentSolarProduction.now})))}}_.defaultProps={latitude:59.9409,longitude:10.6991};var N=Object(l.b)(t=>({currentSolarProduction:t.Solar.current,max:t.Solar.max,powerPrices:t.PowerPrices,initState:t.Init,realtimePowerHjemme:t.TibberRealTime.hjemme,realtimePowerHytta:t.TibberRealTime.hytta,usedPower:t.TibberLastDay}))(_),U=a(175),W=a.n(U);a(394),a(396);var L=W.a.initializeApp({apiKey:"AIzaSyBIJfOzVFrazxX9FkLEOHcf2dKeewXBCpI",authDomain:"tellulf-151318.firebaseapp.com",databaseURL:"https://tellulf-151318.firebaseio.com",projectId:"tellulf-151318",storageBucket:"tellulf-151318.appspot.com",messagingSenderId:"159155087298"}),j=a(176),B=a.n(j),Y=a(41),K=a.n(Y);a(91);function V(t){let e="";if(t.fullDay){if(!t.oneDay){e=c()(t.start).calendar(void 0,{lastWeek:"dddd DD.",nextWeek:"dddd",sameDay:"[I dag]",nextDay:"[I morgen]",sameElse:"DD. MMM"});const a=c()(t.end);a.subtract(1,"day"),e+=" \u2192 ".concat(c()(a).calendar(void 0,{lastWeek:"dddd DD.",nextWeek:"dddd",sameDay:"[I dag]",nextDay:"[I morgen]",sameElse:"DD. MMM"}))}}else{let a={sameDay:"HH:mm",nextDay:"HH:mm",nextWeek:"HH:mm",sameElse:"HH:mm"};t.oneDay||(a={sameDay:"HH:mm",nextDay:"[I morgen] HH:mm",nextWeek:"dddd HH:mm",sameElse:"ddd DD. HH:mm"}),e="".concat(c()(t.start).calendar(void 0,{sameDay:"HH:mm",nextDay:"HH:mm",nextWeek:"HH:mm",sameElse:"HH:mm"})," \u2192 ").concat(c()(t.end).calendar(void 0,a))}return e}class z extends o.a.PureComponent{render(){return o.a.createElement("div",{className:"kalenderSubInfo"},o.a.createElement("div",null,this.props.data.name),o.a.createElement("div",null,V(this.props.data)))}}var q=z;class J extends o.a.PureComponent{render(){return o.a.createElement("div",{className:"kalenderSubInfo"},o.a.createElement("div",null,this.props.data.name),!this.props.data.oneDay&&o.a.createElement("div",null,V(this.props.data)))}}var X=J;class G extends o.a.PureComponent{constructor(t){super(t),this.width=0,this.width=window.innerWidth}getIconLocation(){return"".concat("/weather_symbols","/").concat(this.props.payload.symbol,".png")}getTemp(){return Math.round(this.props.payload.temp)}render(){if(isNaN(this.props.payload.temp)||"undefined"===typeof this.props.payload.symbol)return null;if(this.width<=600){if(new Date(this.props.payload.time).getHours()%2!==0)return null}return o.a.createElement("svg",null,o.a.createElement("text",{x:this.props.cx,y:this.props.cy+20,textAnchor:"middle",fontFamily:"sans-serif",fontSize:"13px",fill:"#ffffff99"},this.getTemp()),o.a.createElement("image",{href:this.getIconLocation(),x:this.props.cx-13,y:this.props.cy-15,height:"26px",width:"26px",opacity:1}),")")}}G.defaultProps={cx:void 0,cy:void 0,payload:void 0};var Q=G,$=a(99),Z=a.n($),tt=a(177),et=a.n(tt),at=a(94),nt=a.n(at);!function(t=(new Date).getFullYear()){const e=[];e.push("0501"),e.push("1225"),e.push("1226"),e.push("0101"),e.push("0517");const a=function(t){var e=Math.floor,a=t%19,n=e(t/100),o=(n-e(n/4)-e((8*n+13)/25)+19*a+15)%30,r=o-e(o/28)*(1-e(29/(o+1))*e((21-a)/11)),s=r-(t+e(t/4)+r+2-n+e(n/4))%7,i=3+e((s+40)/44);return[i,s+28-31*e(i/4)]}(t),n=[t,a[0]-1,a[1]],o=c()(n);e.push(c()(o).subtract(3,"days").format("MMDD")),e.push(c()(o).subtract(2,"days").format("MMDD")),e.push(c()(o).add(1,"days").format("MMDD")),e.push(c()(o).add(39,"days").format("MMDD")),e.push(c()(o).add(50,"days").format("MMDD")),e.sort()}();function ot(t){return c()(t,"x").format("HH")}a(408);const rt="#FFFFFF33",st="#0000FF44",it="#8884d8",ct="#FF000088",lt="#FFFF0022";class ut extends o.a.PureComponent{constructor(t){super(t),this.state=void 0,this.interval=0,this.state={currentTime:c()().valueOf()}}componentDidMount(){this.interval=window.setInterval(()=>this.reloadTime(),6e4)}componentWillUnmount(){window.clearInterval(this.interval)}reloadTime(){this.setState({currentTime:c()().valueOf()})}render(){const t=this.props.from.valueOf(),e=this.props.to.valueOf();return o.a.createElement(v.i,{height:200,width:"100%"},o.a.createElement(v.c,{margin:{top:0,right:0,left:0,bottom:0},data:Object.values(this.props.weather),onClick:this.props.onClick},o.a.createElement(v.j,{scale:"time",dataKey:"time",type:"number",tickFormatter:ot,domain:[t,e],allowDataOverflow:!0}),o.a.createElement(v.k,{width:25,yAxisId:"temp",type:"number",ticks:this.props.limits.ticks,domain:[this.props.limits.lowerRange,this.props.limits.upperRange],hide:!0}),o.a.createElement(v.k,{width:25,label:{angle:90,value:"mm",stroke:"#ffffff55",fill:"#ffffff55",fontSize:15,position:"left"},yAxisId:"rain",allowDataOverflow:!0,type:"number",orientation:"right",domain:[0,1.5],hide:!0}),o.a.createElement(v.b,{stroke:rt,vertical:!1}),this.props.limits.lowerRange<0&&o.a.createElement(v.f,{y1:0,y2:this.props.limits.lowerRange,yAxisId:"temp",stroke:"#00000000",fill:st}),o.a.createElement(v.a,{dot:!1,yAxisId:"rain",connectNulls:!0,type:"natural",dataKey:"rain",stroke:it,fillOpacity:"0.3",isAnimationActive:!1}),o.a.createElement(v.e,{dot:!1,yAxisId:"rain",connectNulls:!0,type:"natural",dataKey:"rainMin",stroke:it,strokeDasharray:"2 2",isAnimationActive:!1}),o.a.createElement(v.e,{dot:!1,yAxisId:"rain",connectNulls:!0,type:"natural",dataKey:"rainMax",stroke:it,strokeDasharray:"2 2",isAnimationActive:!1}),o.a.createElement(v.e,{dot:o.a.createElement(Q,null),yAxisId:"temp",type:"natural",dataKey:"temp",stroke:"#ffffff",opacity:.5,strokeWidth:1,isAnimationActive:!1,connectNulls:!0}),o.a.createElement(v.h,{yAxisId:"temp",x:this.state.currentTime,stroke:ct,strokeWidth:3,strokeDasharray:"3 3"}),o.a.createElement(v.h,{yAxisId:"temp",x:this.props.weatherUpdated.valueOf(),stroke:lt,strokeWidth:3,strokeDasharray:"3 3"}),this.props.showPlace&&o.a.createElement(v.d,{value:this.props.sted})))}}ut.defaultProps={limits:void 0,showPlace:!1,onClick:()=>null};var dt=ut;class mt extends o.a.PureComponent{constructor(t){super(t),this.togglePlace=void 0,this.state={sted:this.loadSted()},this.togglePlace=()=>{const t="oslo"===this.loadSted()?"sandefjord":"oslo";d.a.set("sted_".concat(this.props.date),t),this.setState({sted:t})}}loadSted(){return d.a.get("sted_".concat(this.props.date),"oslo")}getDinner(){try{return this.props.dinner&&this.props.dinner.events?o.a.createElement("div",{className:"kalenderSubInfo"},o.a.createElement("img",{src:"dinner.png",width:15,height:15,alt:"Dinner",style:{filter:"invert(100%)",marginRight:5}}),this.props.dinner.events[0].name):null}catch(t){return console.log(t),null}}getBirthdays(){if(!this.props.birthdays||!this.props.birthdays.events)return[];const t=[];try{this.props.birthdays.events.forEach(e=>{const a=e.name.match(/\d+$/);let n=e.name;if(a){const t=parseInt(a[0],10),e=(new Date).getFullYear()-t;n=n.substring(0,n.length-5),n="".concat(n," (").concat(e,")")}t.push(o.a.createElement("div",{className:"kalenderSubInfo",key:e.id},o.a.createElement("img",{src:"kake.png",width:15,height:15,alt:"Kake",style:{filter:"invert(100%)",marginRight:5}}),n))})}catch(e){console.log(e)}return t}getEvents(){if(!this.props.events||!this.props.events.events)return[];const t=[];try{this.props.events.events.sort((t,e)=>t.start.isBefore(e.start)?-1:1).forEach(e=>{e.fullDay?t.push(o.a.createElement(X,{key:e.id,data:e})):t.push(o.a.createElement(q,{key:e.id,data:e}))})}catch(e){console.log(e)}return t}filterForecast(){return this.props.forecast.data&&this.props.forecast.data[this.state.sted]?function(t,e,a=0,n=0){const o=c()(t).startOf("day").subtract(a,"h"),r=c()(t).endOf("day").add(n,"h");return nt()(e,t=>!(!t.symbol&&!t.temp)&&c()(t.time).isBetween(o,r))}(this.props.date,this.props.forecast.data[this.state.sted].forecast,6,6):{}}getForecastSummary(){return function(t){const e=Object.values(t);if(0===e.length)return"";const a=K()(e,t=>t.temp?t.temp:-999),n=Z()(e,t=>t.temp?t.temp:999),o=et()(e,t=>t.rain?t.rain:0),r=a&&a.temp?Math.round(a.temp):void 0,s=n&&n.temp?Math.round(n.temp):void 0,i=Math.round(o);return r&&s?"".concat(s,"/").concat(r," ").concat(i,"mm"):""}(this.filterForecast())}getWeatherUpdateTime(){return this.props.forecast.data[this.state.sted].updated}getPreggo(){const t=new B.a(new Date("2020-07-22")).getData(this.props.date.toDate());return"".concat(t.percent.toFixed(1),"% - uke ").concat(t.week," dag ").concat(t.dayOfWeek," - ").concat(t.weight,"g - ").concat(t.height," cm")}getWeather(t,e){const a=this.filterForecast();if(!function(t,e){const a=Object.values(e);if(0===a.length)return!1;const n=c()(t).endOf("day"),o=K()(a,"time");return c()(o.time).isAfter(n)}(this.props.date,a))return null;const n=c()(t).startOf("day"),r=c()(t).add(1,"day");return o.a.createElement(dt,{weather:a,from:n,to:r,weatherUpdated:this.getWeatherUpdateTime(),sted:e,showPlace:"oslo"!==e,onClick:this.togglePlace,limits:this.props.forecast.limits})}render(){const t="oslo"!==this.state.sted?this.state.sted.toLocaleUpperCase():null;return o.a.createElement("div",{className:"kalenderDag"},o.a.createElement("div",{className:"kalenderDato"},this.props.date.format("dddd D.")),o.a.createElement("div",{className:"kalenderDato weatherSummary"},this.getForecastSummary()),o.a.createElement("div",{style:{gridColumn:"1 / 3",gridRow:"2 / 4",display:"flex",alignItems:"flex-end"}},this.getWeather(this.props.date,this.state.sted)),o.a.createElement("div",{className:"kalenderSted"},t),o.a.createElement("div",{className:"kalendarDayInfo"},o.a.createElement("div",{className:"preggo"},this.getPreggo()),this.getBirthdays(),this.getDinner(),this.getEvents()))}}var pt=Object(l.b)((function(t){return{forecast:t.Forecast}}))(mt),ht=a(15),ft=a.n(ht),yt=a(178),gt=a.n(yt);function wt(t){return{events:[],sortString:t,sortStamp:Number(c()(t,"YYYY-MM-DD").format("x"))}}function vt(t){try{const e=c()(),a=c()(t.startDate.toJSDate()),n=c()(t.endDate.toJSDate());let o="shiiiiit";t.item&&t.item.summary?o=t.item.summary:t.summary&&(o=t.summary);const r=0===t.startDate.hour&&0===t.endDate.hour&&t.endDate.day!==t.startDate.day;let s=!0;r&&c()(n).subtract(1,"day").startOf("day").isAfter(c()(a).startOf("day"))&&(s=!1),r||(s=a.isSame(n,"day"));let i=a.format("YYYY-MM-DD");a.isBefore(e,"day")&&(i=e.format("YYYY-MM-DD"));let l="shiiiit";return t.uid?l=t.uid:t.item&&t.item.uid&&(l=t.item.uid),{id:l,name:o,start:a,end:n,fullDay:r,oneDay:s,groupString:i}}catch(e){throw console.log(e),new Error("Could not parse iCal event")}}async function Et(t){const e={};try{const a=c()(),n=await ft.a.get(t);if(200!==n.status)throw Error("Couldnt fetch calendar data");const o=new gt.a({ics:n.data,maxIterations:1e3}).between(a.toDate(),a.add(60,"days").toDate()),r={events:[],occurrences:[]};r.events=o.events.sort((t,e)=>t.startDate.toJSDate()-e.startDate.toJSDate()),r.occurrences=o.occurrences.sort((t,e)=>t.item.startDate.toJSDate()-e.item.startDate.toJSDate()),r.occurrences.forEach(t=>{try{const a=vt(t);e[a.groupString]||(e[a.groupString]=wt(a.groupString)),e[a.groupString].events.push(a)}catch(a){console.log(a)}}),r.events.forEach(t=>{try{const a=vt(t);e[a.groupString]||(e[a.groupString]=wt(a.groupString)),e[a.groupString].events.push(a)}catch(a){console.log(a)}})}catch(a){console.log(a)}return e}const Pt="https://us-central1-tellulf-151318.cloudfunctions.net/proxy",xt=encodeURIComponent("https://calendar.google.com/calendar/ical/kvasbo.no_ognucfh1asvpgc50mqms5tu0kk%40group.calendar.google.com/private-7020f002efde8095cc911279983fb92a/basic.ics"),bt=encodeURIComponent("https://calendar.google.com/calendar/ical/kvasbo.no_m3le0buqs8k24ljlumcr1goqqs%40group.calendar.google.com/private-43f7d258dce12c6117d133b621318148/basic.ics"),kt=encodeURIComponent("https://calendar.google.com/calendar/ical/kvasbo.no_upelraeuo31neuoq31f9decudg%40group.calendar.google.com/private-6718a3a9f7b74d60372a3f2be75804d6/basic.ics"),Dt="".concat(Pt,"/?url=").concat(xt),Tt="".concat(Pt,"/?url=").concat(bt),Mt="".concat(Pt,"/?url=").concat(kt);class St extends o.a.PureComponent{constructor(t={}){super(t),this.interval=0,this.state={kalenderData:{},dinners:{},birthdays:{}}}componentDidMount(){this.updateData(),this.interval=window.setInterval(()=>this.updateData(),6e4)}componentWillUnmount(){window.clearInterval(this.interval)}getDays(){const t=[],e=c()().startOf("day"),a=e.clone(),n=[];for(let o=0;o<30;o+=1)n.push(e.clone()),e.add(1,"days");return n.forEach(e=>{const n=e.format("YYYY-MM-DD"),r=e.diff(a,"days"),s=this.state.kalenderData[n],i=this.state.birthdays[n],c=this.state.dinners[n];(r<14||s||i||c)&&t.push(o.a.createElement(pt,{key:"kalenderdag".concat(n),date:e,events:s,dinner:c,birthdays:i}))}),t}async updateData(){try{const t=await Et(Dt),e=await Et(Tt),a=await Et(Mt);this.setState({kalenderData:t,dinners:e,birthdays:a})}catch(t){console.log(t)}}render(){return o.a.createElement("div",{style:{flex:1,overflow:"auto"}},this.getDays())}}var Ct=St;function It(t){return c()(t).add(30,"minutes").startOf("hour").valueOf()}function At(t=14){const e={},a=c()().startOf("day").valueOf(),n=24*t;for(let r=0;r<n;r++){const t=a+36e5*r;e[t]={time:t}}const o=d.a.get("".concat("weatherSeries","_").concat("12"));return o&&Object.values(e).forEach(t=>{o[t.time]&&(e[t.time]=o[t.time])}),e}async function Ht(t,e){const{start:a,end:n}=function(t=3){return{start:c()().startOf("day"),end:c()().add(t,"day").startOf("day")}}(14),o="https://api.met.no/weatherapi/locationforecast/2.0/complete?lat=".concat(t.toString(),"&lon=").concat(e.toString()),r=await ft.a.get(o);if("OK"!==r.statusText)throw Error("Could not fetch Yr data");const s=r.data,i={forecast:At(),lat:t,lon:e,updated:c()(s.properties.meta.updated_at)};return s.properties.timeseries.forEach(t=>{const e=It(t.time);i.forecast[e]=function(t){const e={time:It(t.time)};return e.temp=t.data.instant.details.air_temperature,t.data.next_1_hours?(e.rain=t.data.next_1_hours.details.precipitation_amount,e.rainMin=t.data.next_1_hours.details.precipitation_amount_min,e.rainMax=t.data.next_1_hours.details.precipitation_amount_max,e.symbol=t.data.next_1_hours.summary.symbol_code):t.data.next_6_hours&&(e.rain=t.data.next_6_hours.details.precipitation_amount/6,e.rainMin=t.data.next_6_hours.details.precipitation_amount_min/6,e.rainMax=t.data.next_6_hours.details.precipitation_amount_max/6,e.symbol=t.data.next_6_hours.summary.symbol_code),e}(t)}),function(t,e,a,n){const o={};Object.keys(e).forEach(t=>{const r=e[t];r.time&&c()(r.time).isBetween(a,n,void 0,"[]")&&(o[t]=r)}),d.a.set(t,o)}("".concat("weatherSeries","_").concat("12"),i.forecast,a,n),i}var Ft=a(179),Ot=a.n(Ft),Rt=a(440);const _t=Object(Rt.a)(),Nt="https://api.entur.io/realtime/v1/rest/et?datasetId=RUT&requestorId=".concat(_t);function Ut(t,e=!0){return{type:"UPDATE_INIT_STATUS",key:t,value:e}}function Wt(t){return{type:"UPDATE_SOLAR_MAX",data:t}}function Lt(){return t=>async function(){const t={};try{const e={headers:{"ET-Client-Name":"kvasbo - infoskjerm"}},a=await ft.a.get(Nt,e);if(200!==a.status)throw Error("Couldnt fetch entur data");const n=Ot.a.parse(a.data).ServiceDelivery.EstimatedTimetableDelivery.EstimatedJourneyVersionFrame.EstimatedVehicleJourney;if(!n||!n.filter)return t;n.filter(t=>"1"===t.DirectionRef&&"RUT:Line:1"===t.LineRef).forEach(e=>{e.EstimatedCalls&&e.EstimatedCalls.EstimatedCall&&e.EstimatedCalls.EstimatedCall.length&&e.EstimatedCalls.EstimatedCall.forEach(a=>{if(a.StopPointRef&&"NSR:Quay:11460"!==a.StopPointRef)return;const n={ruteTid:c()(a.AimedArrivalTime),faktiskTid:c()(a.ExpectedArrivalTime),id:"".concat(e.FramedVehicleJourneyRef.DataFrameRef,"_").concat(e.FramedVehicleJourneyRef.DatedVehicleJourneyRef),linje:e.LineRef,skalTil:a.DestinationDisplay};t[n.id]=n})})}catch(e){console.log(e)}return t}().then(e=>t(function(t){return{type:"UPDATE_TRAINS",trains:t}}(e)))}function jt(t,e,a){return n=>Ht(t,e).then(t=>n(function(t,e){return{type:"UPDATE_FORECAST",data:t,sted:e}}(t,a)))}function Bt(t){const e=c()();return{...t,fromNow:t.faktiskTid.diff(e,"s"),fromNowM:t.faktiskTid.diff(e,"m"),ruteDiff:t.faktiskTid.diff(t.ruteTid,"m")}}class Yt extends o.a.PureComponent{constructor(...t){super(...t),this.intervalId=0,this.componentDidMount=()=>{window.setTimeout(()=>this.updateTrains(),5e3),this.intervalId=window.setInterval(()=>this.updateTrains(),6e4)},this.componentWillUnmount=()=>{window.clearInterval(this.intervalId)}}updateTrains(){this.props.dispatch(Lt())}getTrainList(){let t=[];const e=Object.values(this.props.trains);for(let n=e.length-1;n>-1;n-=1){const a=Bt(e[n]);t.push(a)}t=t.sort((t,e)=>t.fromNow-e.fromNow).slice(0,5);const a=[];for(let n=0;n<t.length;n+=1){const e=0===n?18:14;a.push(o.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginBottom:10,fontSize:e},key:t[n].id},o.a.createElement("div",{style:{flex:1}},t[n].fromNowM,"m"),o.a.createElement("div",{style:{flex:1}},t[n].faktiskTid.format("HH:mm")),o.a.createElement("div",{style:{flex:2.2}},t[n].skalTil)))}return a}render(){return o.a.createElement("div",{style:{display:"flex",padding:"0.5vh",flexDirection:"column",flex:1,justifyContent:"flex-end"}},this.getTrainList())}}var Kt=Object(l.b)()(Yt);c.a.locale("nb");class Vt extends n.PureComponent{constructor(t){super(t),this.interval=0,this.state={time:c()()}}componentDidMount(){this.interval=window.setInterval(()=>this.setState({time:c()()}),1e3)}componentWillUnmount(){window.clearInterval(this.interval)}render(){return n.createElement("div",{className:"clockTime",onClick:()=>this.props.onClick()},this.state.time.format("HH:mm"))}}var zt=Vt;class qt extends n.PureComponent{constructor(...t){super(...t),this.setBool=(t,e)=>{d.a.set(t,e),window.location.reload()}}async signOut(){await L.auth().signOut(),window.location.reload()}render(){const t=d.a.get("showEnergy",!0),e=d.a.get("showTrains",!0);return n.createElement("div",{style:{display:"flex",flex:1,flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},n.createElement("div",null,n.createElement("label",{htmlFor:"showEnergy"},"Show Energy"),n.createElement("input",{type:"checkbox",checked:t,id:"showEnergy",onChange:()=>this.setBool("showEnergy",!t)})),n.createElement("div",null,n.createElement("label",{htmlFor:"showTrains"},"Show trains"),n.createElement("input",{type:"checkbox",checked:e,id:"showTrains",onChange:()=>this.setBool("showTrains",!e)})),n.createElement("button",{type:"button",onClick:()=>this.signOut()},"Logg ut"),n.createElement("button",{type:"button",onClick:()=>window.location.reload()},"Last inn p\xe5 nytt"))}}var Jt=qt;a(435);const Xt={lat:59.9409,long:10.6991},Gt={lat:59.1347,long:10.325};class Qt extends o.a.PureComponent{constructor(t){super(t),this.interval=0,this.width=0,this.toggleMode=void 0,this.state={setupMode:!1},this.toggleMode=()=>{this.setState({setupMode:!this.state.setupMode})}}componentDidMount(){this.startReloadLoop(),this.attachNetatmoListener(),this.updateWeather(),this.width=window.innerWidth,this.interval=window.setInterval(()=>this.updateWeather(),9e5)}componentWillUnmount(){window.clearInterval(this.interval)}attachNetatmoListener(){L.database().ref("netatmo/currentData").on("value",t=>{if(t){const e=t.val();this.props.dispatch(function(t){return{type:"NETATMO_UPDATE",data:t}}(e))}});L.database().ref("netatmo/areaData").on("value",t=>{if(t){const e=t.val();this.props.dispatch(function(t){return{type:"NETATMO_UPDATE_AVERAGES",data:t}}(e))}})}updateWeather(){try{this.props.dispatch(jt(Xt.lat,Xt.long,"oslo")),this.props.dispatch(jt(Gt.lat,Gt.long,"sandefjord"))}catch(t){console.log(t)}}startReloadLoop(){const t=c()(),e=c()(t).startOf("hour").add(1,"hour").add(5,"seconds").diff(t,"milliseconds");setTimeout(()=>{window.location.reload()},e)}render(){const t=d.a.get("showEnergy",!0),e=d.a.get("showTrains",!0),a=this.width>600&&t,n=this.width>600&&e;return o.a.createElement("div",{className:"grid"},o.a.createElement("div",{className:"block gridCalendar"},o.a.createElement(Ct,{key:"tellulf-kalender"})),o.a.createElement("div",{className:"block gridClock"},o.a.createElement(zt,{onClick:this.toggleMode}),o.a.createElement("div",{className:"gridNetatmoTemp"},this.props.temperature,"\xb0")),a&&o.a.createElement("div",{className:"block gridEnergy"},o.a.createElement(N,{key:"tellulf-energi",updaters:this.props.updaters})),n&&o.a.createElement("div",{className:"block gridTrains"},o.a.createElement(Kt,{trains:this.props.trains,key:"tellulf-trains"})),this.state.setupMode&&o.a.createElement("div",{className:"block gridSettings"},o.a.createElement(Jt,null)))}}var $t=Object(l.b)((function(t){return{trains:t.Trains,temperature:t.NetatmoAverages.temperature,netatmo:t.NetatmoAverages}}))(Qt),Zt=a(24),te=a(180);const ee={data:{},limits:{maxRain:0,maxTemp:0,upperRange:0,lowerRange:0,minTemp:0,ticks:[]}};const ae={co2:0,inneFukt:0,inneTemp:0,inneTrykk:0,inneTrykkTrend:"",updated:null,updatedNice:""};const ne={humidity:0,pressure:0,temperature:0,time:0};const oe={max:{maxDay:0,maxMonth:0,maxYear:0,maxEver:0},current:{averageFull:0,averageMinute:0,month:0,now:0,today:0,total:0,year:0,byHour:[],currentTime:c()(),dataTime:null}};const re={};var se=a(181),ie=a.n(se);const ce={},le={};ce.hjemme=.4833,ce.hytta=.4229,le.hjemme=.05,le.hytta=.05;const ue={accumulatedConsumption:0,accumulatedCost:0,accumulatedProduction:0,accumulatedReward:0,averagePower:0,actualCost:0,currency:"NOK",lastMeterConsumption:0,lastMeterProduction:0,maxPower:0,maxPowerProduction:0,minPower:0,minPowerProduction:0,power:0,powerProduction:0,timestamp:(new Date).toISOString(),calculatedConsumption:0,calculatedHomeAndCabinTotal:0,previousMeasuredProduction:0,lastHourByTenMinutes:{},avgLastHour:0,avgLastHourSamples:0,avgLastHourStamp:(new Date).toISOString()},de={hytta:ue,hjemme:ue,totalNetUsage:0};var me=Object(Zt.c)({Init:function(t={powerPrices:!1,solar:!1},e){const a=e;switch(a.type){case"UPDATE_INIT_STATUS":{const e={...t};return e[a.key]=a.value,e}default:return t}},Netatmo:function(t=ae,e){const a=e;switch(a.type){case"NETATMO_UPDATE":return{...t,...a.data};default:return t}},NetatmoAverages:function(t=ne,e){const a=e;switch(a.type){case"NETATMO_UPDATE_AVERAGES":try{const e=t;return e.humidity=a.data.humidity,e.pressure=a.data.pressure,e.temperature=a.data.temperature,e.time=a.data.time,{...t,...a.data}}catch(n){return console.log(n),ne}default:return t}},Solar:function(t=oe,e){const a=e;switch(a.type){case"UPDATE_SOLAR_MAX":return{...t,max:{...t.max,...a.data}};case"UPDATE_SOLAR_CURRENT":return{...t,current:{...t.current,...a.data}};default:return t}},PowerPrices:function(t=re,e){const a=e;switch(a.type){case"UPDATE_POWER_PRICES":try{return{...a.data}}catch(n){return console.log(n),re}default:return t}},Trains:function(t={},e){const a=e;switch(a.type){case"UPDATE_TRAINS":return{...ie()(t,t=>c()().isAfter(t.faktiskTid)),...a.trains};default:return t}},TibberRealTime:function(t=de,e){const a=e;switch(a.type){case"UPDATE_TIBBER_REALTIME_CONSUMPTION":{const{accumulatedConsumption:e,accumulatedCost:o,accumulatedProduction:r,accumulatedReward:s,averagePower:i,currency:l,lastMeterConsumption:u,lastMeterProduction:d,maxPower:m,maxPowerProduction:p,minPower:h,minPowerProduction:f,power:y,powerProduction:g,timestamp:w}=a.data,v=c()(w),E=function(t,e,a,n,o){let r=e-n;return r+=t*ce[o],r-=a*le[o],r}(e,o,r,s,a.where),P=v.format("dddHH");let x=t[a.where].avgLastHourSamples?t[a.where].avgLastHourSamples+1:1,b=Math.round(t[a.where].avgLastHour+(y-t[a.where].avgLastHour)/x);t[a.where].avgLastHourStamp!==P&&(b=Math.round(y),x=1);const k=t[a.where].lastHourByTenMinutes?t[a.where].lastHourByTenMinutes:{};let D=y,T=t[a.where].previousMeasuredProduction;D||(g>0&&(T=g),D=-1*T);try{const e=t[a.where].lastHourByTenMinutes?t[a.where].lastHourByTenMinutes:{},n=Math.floor(v.minutes()/10),o=c()(v).minutes(10*n).startOf("minute").toISOString();e[o]||(e[o]={startTime:o,usage:y,samples:1})}catch(n){console.log(n)}const M={...t,[a.where]:{...t[a.where],accumulatedConsumption:e,accumulatedCost:o,accumulatedProduction:r,accumulatedReward:s,averagePower:i,currency:l,lastMeterConsumption:u,lastMeterProduction:d,maxPower:m,maxPowerProduction:p,minPower:h,minPowerProduction:f,power:y,powerProduction:g,timestamp:w,avgLastHour:b,avgLastHourSamples:x,avgLastHourStamp:P,lastHourByTenMinutes:k,calculatedConsumption:D,previousMeasuredProduction:T,actualCost:E}};return M.totalNetUsage=t.hjemme.calculatedConsumption+t.hytta.calculatedConsumption,M}default:return t}},TibberLastDay:function(t={},e){const a=e;switch(a.type){case"UPDATE_TIBBER_POWER_USAGE":{const t=c()(),e={};return a.data.forEach(a=>{const n=c()(a.to),o=c()(a.from);if(n.isSame(t,"day")&&o.isSame(t,"day")){const t=o.format("H"),n=c()(o).add(30,"minutes").valueOf();e[t]={...a,calculatedTime:n}}}),e}default:return t}},Forecast:function(t=ee,e){const a=e;switch(a.type){case"UPDATE_FORECAST":{const e={...t};return e.data[a.sted]=a.data,e.limits=function(t){const e=[];Object.values(t).forEach(t=>{Object.values(t.forecast).forEach(t=>{e.push(t)})});const a=K()(e,"temp"),n=K()(e,"rainMax"),o=Z()(e,"temp"),r=o&&o.temp?o.temp:0,s=a&&a.temp?a.temp:0,i=n&&n.rainMax?n.rainMax:0,c=10*Math.floor((r-2)/10),l=10*Math.ceil((s+2)/10),u=r>0?0:Math.min(0,c),d=Math.max(u+30,l),m=[];for(let p=u;p<=d;p+=10)m.push(p);return{minTemp:r,maxTemp:s,maxRain:i,lowerRange:u,upperRange:d,ticks:m}}(e.data),e}default:return t}}});const pe=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Zt.d,he=Object(Zt.e)(me,pe(Object(Zt.a)(te.a))),fe={Hjemme:{fast:100,kwh:.4795,kwpProd:.07},Hytta:{fast:287.5,kwh:.41913,kwhProd:.07}};c.a.locale("nb");const ye={tibber:new class{constructor(t){this.store=void 0,this.store=t}async updatePowerPrices(){const t=await this.getTibberSettings(),e='\n    {\n      viewer {\n        home(id: "'.concat(t.tibberHomeKey,'") {\n          currentSubscription {\n            priceInfo {\n              today {\n                total\n                energy\n                tax\n                startsAt\n              }\n            }\n          }\n        }\n      }\n    }\n');try{const a=await ft()({url:"https://api.tibber.com/v1-beta/gql",method:"post",headers:{Authorization:"bearer ".concat(t.tibberApiKey)},data:{query:e}});if(200===a.status){const t=a.data.data.viewer.home.currentSubscription.priceInfo.today,e={};t.forEach(t=>{const a=c()(t.startsAt).hours();e[a]={total:t.total+.477}}),this.store.dispatch(function(t){return{type:"UPDATE_POWER_PRICES",data:t}}(e)),this.store.dispatch(Ut("powerPrices"))}}catch(a){console.log(a)}}async updateConsumption(){const t=await this.getTibberSettings(),e='\n    {\n      viewer {\n        home(id: "'.concat(t.tibberHomeKey,'") {\n          consumption(resolution: HOURLY, last: 24) {\n            nodes {\n              from\n              to\n              totalCost\n              unitCost\n              unitPrice\n              unitPriceVAT\n              consumption\n              consumptionUnit\n            }\n          }\n        }\n      }\n    }\n');try{const a=await ft()({url:"https://api.tibber.com/v1-beta/gql",method:"post",headers:{Authorization:"bearer ".concat(t.tibberApiKey)},data:{query:e}});if(200===a.status){const t=a.data.data.viewer.home.consumption.nodes;this.store.dispatch(function(t){return{type:"UPDATE_TIBBER_POWER_USAGE",data:t}}(t))}}catch(a){console.log(a)}}async subscribeToRealTime(t,e){L.database().ref("tibber/realtime/".concat(t)).on("value",t=>{try{if(null===t)return;const a=t.val(),n={accumulatedConsumption:a.accumulatedConsumption,accumulatedCost:a.accumulatedCost,accumulatedProduction:a.accumulatedProduction,accumulatedReward:a.accumulatedReward,averagePower:a.averagePower,currency:a.currency,lastMeterConsumption:a.lastMeterConsumption,lastMeterProduction:a.lastMeterProduction,maxPower:a.maxPower,maxPowerProduction:a.maxPowerProduction,minPower:a.minPower,minPowerProduction:a.minPowerProduction,power:a.power,powerProduction:a.powerProduction,timestamp:a.timestamp};this.store.dispatch(function(t,e){return{type:"UPDATE_TIBBER_REALTIME_CONSUMPTION",data:t,where:e}}(n,e))}catch(a){console.log(a)}})}async updateConsumptionDaily(){const t=await this.getTibberSettings(),e=(new Date).getDate(),a="\n    {\n      viewer {\n        homes {\n          id\n          appNickname\n          consumption(resolution: DAILY, last: ".concat(e,") {\n            nodes {\n              from\n              to\n              totalCost\n              unitCost\n              unitPrice\n              unitPriceVAT\n              consumption\n              consumptionUnit\n            }\n          }\n          production(resolution: DAILY, last: ").concat(e,") {\n            nodes {\n              from\n              to\n              unitPrice\n              unitPriceVAT\n              production\n              productionUnit\n              profit\n            }\n          }\n        }\n      }\n    }\n");try{const e=await ft()({url:"https://api.tibber.com/v1-beta/gql",method:"post",headers:{Authorization:"bearer ".concat(t.tibberApiKey)},data:{query:a}});if(200===e.status){const t=[],a=[],n=c()();e.data.data.viewer.homes.forEach(e=>{e.consumption.nodes.forEach(e=>{c()(e.from).isSame(n,"month")&&t.push(e)}),e.production.nodes.forEach(t=>{c()(t.from).isSame(n,"month")&&a.push(t)})}),this.store.dispatch(function(t){return{type:"UPDATE_TIBBER_USAGE_MONTH",data:t}}(t)),this.store.dispatch(function(t){return{type:"UPDATE_TIBBER_PRODUCTION_MONTH",data:t}}(a))}}catch(n){console.log(n)}}async updateConsumptionMonthlyAndCalculateBills(){const t=await this.getTibberSettings();try{const e=await ft()({url:"https://api.tibber.com/v1-beta/gql",method:"post",headers:{Authorization:"bearer ".concat(t.tibberApiKey)},data:{query:"\n    {\n      viewer {\n        homes {\n          id\n          appNickname\n          consumption(resolution: MONTHLY, last: 3) {\n            nodes {\n              from\n              to\n              totalCost\n              unitCost\n              unitPrice\n              unitPriceVAT\n              consumption\n              consumptionUnit\n            }\n          }\n        }\n      }\n    }\n"}});if(200===e.status){e.data.data.viewer.homes.forEach(t=>{console.group(t.appNickname),console.info("OBS: Mangler produksjonsdata!"),t.consumption.nodes.forEach(e=>{const a=c()(e.from).format("MMMM"),n=e.totalCost,o=e.consumption*fe[t.appNickname].kwh+fe[t.appNickname].fast,r=n+o;console.group("".concat(a,": ")),console.log("Str\xf8m: ".concat(n.toFixed(2).toLocaleString())),console.log("Nett: ".concat(o.toFixed(2).toLocaleString())),console.log("Totalt: ".concat(r.toFixed(2).toLocaleString())),console.groupEnd()}),console.groupEnd()})}}catch(e){console.log(e)}}async getTibberSettings(){const t=L.database().ref("settings");return(await t.once("value")).val()}}(he),solar:new class{constructor(t){this.store=void 0,this.store=t}async attachListeners(){L.database().ref("steca/currentData").on("value",t=>{try{if(null===t)return;const e=t.val(),a="undefined"!==typeof e.averages.time?c()(e.averages.time):c()(0),n="undefined"!==typeof e.effect.val?e.effect.val:0,o="undefined"!==typeof e.today.val?e.today.val:0,r="undefined"!==typeof e.month.val?e.month.val:0,s="undefined"!==typeof e.year.val?e.year.val:0,i="undefined"!==typeof e.total.val?e.total.val:0,l="undefined"!==typeof e.averages.full?e.averages.full:0,u="undefined"!==typeof e.averages[1]?e.averages[1]:0,d="undefined"!==typeof e.todayByHour.val?function(t){const e=c()().startOf("day");return t.map(t=>({time:c()(e).add(t.minutesFromMidnight,"minutes").valueOf(),production:t.production}))}(e.todayByHour.val):[],m={now:n,today:o,month:r,year:s,total:i,byHour:d,currentTime:c()(),averageFull:l,averageMinute:u,dataTime:a};this.store.dispatch({type:"UPDATE_SOLAR_CURRENT",data:m}),this.store.dispatch(Ut("solar"))}catch(e){console.log(e)}})}async attachMaxListeners(){const t=c()(),e=t.format("YYYY"),a=t.format("MM"),n=t.format("DD"),o="steca/maxValues/daily/".concat(e,"/").concat(a,"/").concat(n),r="steca/maxValues/monthly/".concat(e,"/").concat(a),s="steca/maxValues/yearly/".concat(e);L.database().ref(o).on("value",t=>{if(null===t)return;const e=t.val();if(e&&e.value){const t={maxDay:e.value};this.store.dispatch(Wt(t))}}),L.database().ref(r).on("value",t=>{if(null===t)return;const e=t.val();if(e&&e.value){const t={maxMonth:e.value};this.store.dispatch(Wt(t))}}),L.database().ref(s).on("value",t=>{if(null===t)return;const e=t.val();if(e&&e.value){const t={maxYear:e.value};this.store.dispatch(Wt(t))}}),L.database().ref("steca/maxValues/ever/").on("value",t=>{if(null===t)return;const e=t.val();if(e&&e.value){const t={maxEver:e.value};this.store.dispatch(Wt(t))}})}}(he)};class ge extends o.a.PureComponent{constructor(t){super(t),this.state=void 0,this.state={loggedIn:!1,user:null,username:"",password:""}}componentDidMount(){L.auth().onAuthStateChanged(t=>{t&&this.setState({loggedIn:!0,user:t})})}doLogin(){this.state.username&&this.state.password||alert("Tast inn brukernavn og passord din slask"),L.auth().signInWithEmailAndPassword(this.state.username,this.state.password).catch(t=>{const e=t.code,a=t.message;alert("".concat(e," ").concat(a)),this.setState({username:null,password:null})})}getLogin(){return o.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,margin:0,height:"100vh",width:"100vw",flexDirection:"column"}},o.a.createElement("div",null,o.a.createElement("input",{type:"text",value:this.state.username,placeholder:"Brukernavn",onChange:t=>this.setState({username:t.target.value})})),o.a.createElement("div",null,o.a.createElement("input",{type:"text",value:this.state.password,placeholder:"Passord",onChange:t=>this.setState({password:t.target.value})})),o.a.createElement("div",null,o.a.createElement("button",{disabled:!this.state.username&&!this.state.password,onClick:()=>this.doLogin()},"Logg inn")))}render(){return this.state.loggedIn?o.a.createElement(l.a,{store:he},o.a.createElement($t,{loggedIn:this.state.loggedIn,updaters:ye})):this.getLogin()}}var we=ge;s.a.render(o.a.createElement(we,null),document.getElementById("root"))},91:function(t,e,a){}},[[205,1,2]]]);
//# sourceMappingURL=main.9f15b6a2.chunk.js.map